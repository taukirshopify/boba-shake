class TagsFilter extends HTMLElement{constructor(){super(),this.selectors={mainContent:"#MainContent",section:'section[data-section-type="collection-template"]',collectionHeader:'[data-section-type="collection-header"]',productGridContainer:"#CollectionProductGrid",sorting:'select[name="sort_by"]',initialActiveSortingOption:".m-sortby-mobile--content li.active"},this.preventClick=!1}connectedCallback(){this.domNodes=queryDomNodes(this.selectors),this.setData(),this.listeners=[addEventDelegate({selector:"[data-tag-filter]",handler:this.handleFilter})],this.initSorting(),this.setLoadingTarget()}disconnectedCallback(){this.listeners.forEach((t=>t()))}setData=()=>{const{section:t,initialActiveSortingOption:e}=this.domNodes;this.enableSorting="true"===t.dataset.enableSorting,this.filtersPosition=t.dataset.filtersPosition,this.sectionId=t.dataset.sectionId,this.activeSortingOption=e};handleFilter=(t,e)=>{if(t.preventDefault(),this.preventClick)return;this.preventClick=!0;const i=e.querySelector("a").href;i&&this.fetchSectionHtml(i)};initSorting(){this.enableSorting&&(this.domNodes.sorting&&this.domNodes.sorting.addEventListener("change",(t=>{const e=t&&t.target&&t.target.value;this.handleSorting(e)})),addEventDelegate({selector:".m-sortby-mobile--content li",handler:(t,e)=>{e!==this.activeSortingOption&&(this.activeSortingOption&&this.activeSortingOption.classList.remove("active"),e.classList.add("active"),this.activeSortingOption=e,MinimogTheme.Collection.closeMobileSorting(),this.handleSorting(e.dataset.value))}}))}handleSorting=t=>{t&&(updateParam("sort_by",t),this.fetchSectionHtml(window.location.href))};fetchSectionHtml(t){this.loading.start(),fetch(t).then((t=>{if(t.ok)return t.text();throw new Error("Failed to load section!")})).then((e=>{this.preventClick=!1,this.renderCollectionHeader(e),this.renderProductGrid(e),this.updateBrowserHistory(t),MinimogTheme.Collection.init(),this.loading.finish(this.scrollToTop)}))}renderCollectionHeader=t=>{const e=(new DOMParser).parseFromString(t,"text/html").querySelector(this.selectors.collectionHeader);this.domNodes.collectionHeader&&this.domNodes.collectionHeader.replaceWith(e)};renderProductGrid=t=>{const e=(new DOMParser).parseFromString(t,"text/html");document.title=e&&e.querySelector("title")&&e.querySelector("title").innerText;const i=e.querySelector(this.selectors.section);this.domNodes.section.replaceWith(i)};setLoadingTarget=()=>{const t=window.innerWidth<768?"mobile":"desktop",{productGridContainer:e}=this.domNodes,i="mobile"===t||"fixed"===this.filtersPosition?{}:{overlay:e};this.loading=new MinimogLibs.AnimateLoading(document.body,i)};updateBrowserHistory(t){window.history.replaceState({path:t},"",t)}scrollToTop=()=>{const t=document.getElementById("CollectionProductGrid");MinimogTheme.scrollIntoView(t,{align:{topOffset:80}})}}customElements.define("collection-tags-filters",TagsFilter);